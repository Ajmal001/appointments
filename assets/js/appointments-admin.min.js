/*!  - v2.4.3-beta.1
 * https://premium.wpmudev.org/project/appointments-plus/
 * Copyright (c) 2019; * Licensed GPLv2+ */
!function(a){function b(c){a.post(_app_admin_data.ajax_url,{action:"app-gcal-export_and_update"},function(a){var d=parseInt(a.remaining,10),e=a.msg;c.empty().append("<p>"+e+"</p>"),d&&d>0&&b(c)},"json")}function c(b){var c=a(this),d=!1,e=!1;return b&&b.preventDefault&&b.preventDefault(),b&&b.stopPropagation&&b.stopPropagation(),!!(d=c.attr("data-target"))&&(e=a(".app-info_target."+d),!!e.length&&(e.is(":visible")?e.hide("fast"):e.show("fast"),!1))}a(function(){a(".app-add_break").on("click",function(){var b=a(this),c=b.parents("tr").first(),d={};return c.find("select").each(function(){var b=a(this),c=b.attr("name"),d=c.replace(/\[\d*\]$/,""),e=a('[name^="'+d+'"]');e.length&&e.each(function(){a(this).attr("name",d+"[]")})}),d=c.clone(),d.find("a.app-add_break").remove().end().find("td:first").empty(),c.after(d),!1}),a(".app-working_hours-workhour_form tr.app-repeated").each(function(){var b=a(this).find("td:last");b.append('<a href="#remove-break" class="app-remove_break"></a>')}),a(document).on("click",".app-remove_break",function(b){b.preventDefault();var c=a(this).closest("tr.app-repeated");return!!c.length&&(c.remove(),!1)}),a(document).on("click",".app-settings-column_meta_info-toggle",function(){var b=a(this),c=b.parents(".app-settings-column_meta_info"),d=c.find(".app-settings-column_meta_info-content");return d.is(":visible")?(d.hide(),b.text(b.attr("data-off"))):(d.show(),b.text(b.attr("data-on"))),!1})}),a(function(){var c=a(".app-gcal-export_and_update");if(!c.length)return!1;var d=c.closest("td"),e=d.find(".app-gcal-result");c.on("click",function(a){a.preventDefault(),a.stopPropagation(),e.empty().append("<p>"+_app_admin_data.strings.preparing_export+"</p>"),b(e)})}),a(function(){a(document).on("click",".app-info_trigger",c)}),a(document).on("click",".notice-app-gdpr a, .notice-app-gdpr button",function(){var b=a(this).closest(".notice"),c={action:b.attr("id"),url:ajaxurl,user_id:b.data("user_id"),nonce:b.data("nonce")};return a.post(ajaxurl,c),!0})}(jQuery),AppointmentsAdmin=window.AppointmentsAdmin||{},function(a,b,c){"use strict";function d(a){function d(){var a=c("#the-list .check-column :checked");a.length?c("#app-export-selected").show():c("#app-export-selected").hide()}var e={servicesPrice:[]};return this.options=c.extend({},e,a),this.isEditing=!1,this.$exportButton=c(".app-export_trigger"),this.$addNew=c(".add-new-h2"),this.$addNewSpinner=c(".add-new-waiting"),this.$editAppointment=c(".app-inline-edit"),this.$table=c("table.appointments"),c("#delete_removed").click(function(a){return confirm(b.deleteRecordsConfirm)}),this.$addNew.click(function(){this.$addNewSpinner.show(),this.removeActiveEditorForms(),this.showEditorForm(0,function(a){this.$table.prepend(a),this.$addNewSpinner.hide()})}.bind(this)),this.$editAppointment.click(function(a){var b=c(a.target).data("app-id"),d=c("#app-"+b),e=d.find(".waiting");e.show(),this.removeActiveEditorForms(),this.showEditorForm(b,function(a){e.hide(),d.hide(),d.after(a)})}.bind(this)),this.$table.on("click",".cancel",this.removeActiveEditorForms.bind(this)),this.$table.on("change",'select[name="service"]',function(a){var b=c(a.target),d=b.val();this.options.servicesPrice[d]&&b.parents(".inline-edit-col").find('input[name="price"]').val(this.options.servicesPrice[d])}.bind(this)),this.$table.on("click",".save",this.saveEditor.bind(this)),this.$table.on("change","select[name=worker]",this.fetchWorkerHours.bind(this)),this.$exportButton.click(function(a){var b=c(a.target),d=b.closest("form"),e=c(".column-delete.app-check-column :checked"),f=d.find("#app-export_type");return b.is("#app-export-selected")&&e.length?(e.each(function(){d.append("<input type='hidden' name='app[]' value='"+c(this).val()+"' />")}),f.val("selected"),!0):b.is("#app-export-type")?(d.append("<input type='hidden' name='status' value='"+b.attr("data-type")+"' />"),f.val("type"),!0):!!b.is("#app-export-all")&&(f.val("all"),!0)}),c(".app-change-status-btn").click(function(a){var b=c(this),d=c("th.app-check-column input:checkbox:checked");return d.each(function(){b.after('<input type="hidden" name="app[]" value="'+c(this).val()+'"/>')}),!0}),c(".info-button").click(function(){c(".status-description").toggle("fast")}),c(document).on("change",".check-column input, .app-column-cb input",d),c(d),this}d.prototype.removeActiveEditorForms=function(){this.$table.find(".inline-edit-row").hide(),c(".app-tr").show()},d.prototype.showEditorForm=function(a,d){var e={action:"inline_edit",col_len:this.options.columns,app_id:a,nonce:this.options.nonces.addNew,columns:this.options.columns};return c.post(ajaxurl,e,function(a){a&&a.error?alert(a.error):a&&"function"==typeof d?(d.call(this,[a.result]),this.initDatepicker()):alert(b.unexpectedError)}.bind(this),"json")},d.prototype.initDatepicker=function(){c(".datepicker").datepicker({dateFormat:"yy-mm-dd",firstDay:AppointmentsDateSettings.weekStart})},d.prototype.fetchWorkerHours=function(a){var d=c(a.target),e=d.val(),f=d.parents(".inline-edit-row"),g=f.find("select[name=service]").val(),h=f.find("select[name=location]"),i=f.find("select[name=time]"),j=i.val(),k=i.children("option:first"),l=f.find(".waiting"),m={};l.show(),m.nonce=this.options.nonces.editApp,m.action="inline_fetch_worker_slots",m.worker_id=e,m.app_id=g,m.selected_slot=j,"undefined"!=typeof h&&(m.location_id=h.val()),c.post(ajaxurl,m,function(a){if(l.hide(),a&&a.error){var e=c("<div />",{"class":"error"}).html(a.error);return d.after(e),void e.delay(1e4).fadeOut("slow")}if(!a)return void alert(b.unexpectedError);var f=JSON.parse(a.message);i.empty().append('<option value="'+k.val()+'">'+k.text()+"</option>");for(var g in f)i.append(f[g])}.bind(this),"json")},d.prototype.saveEditor=function(a){var d=c(a.target),e=d.parents(".inline-edit-row"),f=e.find(".waiting");f.show();var g=["user","cname","email","phone","address","city","service","worker","price","date","time","note","status"],h={};c.map(g,function(a){"cname"===a?h.name=e.find('[name="'+a+'"]').val():h[a]=e.find('[name="'+a+'"]').val()});var i=d.data("app-id"),j=e.find(".cancel");h.app_id=i,h.resend=e.find('input[name="resend"]').is(":checked")?1:0,h.nonce=this.options.nonces.editApp,h.action="inline_edit_save",c(document).trigger("app-appointment-inline_edit-save_data",[h,e]),c.post(ajaxurl,h,function(a){return f.hide(),a&&a.error?void e.find(".error").html(a.error).show().delay(1e4).fadeOut("slow"):a?(e.find(".error").html(a.message).show().delay(1e4).fadeOut("slow"),i&&parseInt(i,10)||!a||!a.app_id||location.reload(),a.reload&&location.reload(),void(j[0].innerHTML="Close")):void alert(b.unexpectedError)}.bind(this),"json")},a.appointmentsList=function(a){return new d(a)}}(AppointmentsAdmin,_app_admin_data,jQuery),jQuery(document).ready(function(a){a(".gcal-slider").unslider({nav:!1})}(jQuery));var AppDatepicker=function(a){function b(a){var b=new String(a);return 1==b.length&&(b="0"+b),b}var c,d,e=[],f={init:function(a){var f=this,g={dateFormat:"yy-mm-dd",numberOfMonths:2};g.onSelect=function(a){f.toggleDate(a)},g.beforeShowDay=function(a){var c=a.getFullYear(),d=b(a.getMonth()+1),f=b(a.getDate()),g=c+"-"+d+"-"+f,h=jQuery.inArray(g,e);return h>=0?[!0,"ui-state-highlight"]:[!0,""]},c=jQuery(a.data("rel"));var h=c.val().split(",");for(i in h)this.toggleDate(h[i]);d=a.datepicker(g)},toggleDate:function(a){var b=jQuery.inArray(a,e);b>-1?e.splice(b,1):e.push(a),this.updateRel()},updateRel:function(){c.val(this.getDates().join(","))},getDates:function(){return e}};return f.init(a),f};window.AppDatepicker=AppDatepicker,function(){tinymce.PluginManager.add("appointments_shortcodes",function(a){function b(b){var e,f=[];for(var g in b.defaults)e=c(g,b.defaults[g]),e&&f.push(e);return{text:b.name,onclick:function(){a.windowManager.open({title:b.name,body:f,onsubmit:d(b)})}}}function c(a,b){var c={};switch(b.type){case"text":c={type:"textbox",name:a,label:b.name,value:b.value};break;case"datepicker":c={type:"textbox",name:a,label:b.name,value:b.value,onclick:function(){var a=this._id,b=jQuery("#"+a);if(g.indexOf(a)<0){if(g.push(a),!b.length||"undefined"==typeof b.datepicker)return;b.datepicker(),b.datepicker("option","dateFormat","yy-mm-dd"),b.datepicker("option","firstDay",AppointmentsDateSettings.weekStart)}"function"==typeof b.datepicker&&b.datepicker("show")}};break;case"select":c={type:"listbox",name:a,label:b.name,values:b.options};break;case"checkbox":c={type:"checkbox",name:a,label:b.name,value:1},b.value&&(c.checked=!0)}return b.help&&(c.tooltip=b.help),c}function d(b){return function(c){var d,e="";for(var f in b.defaults)"undefined"!=typeof c.data[f]&&b.defaults[f].value!=c.data[f]&&(d=c.data[f],"checkbox"===b.defaults[f].type&&(d=d?1:0),e+=" "+f+'="'+d+'"');a.insertContent("["+b.shortcode+e+"]")}}var e,f,g=[],h=tinymce.activeEditor,i=[];f=h.getLang("appointments_shortcodes.shortcodes");for(var j in f)e=f[j],i.push(function(a){return b(a)}(e));a.addButton("appointments_shortcodes",{text:h.getLang("appointments_shortcodes.label"),type:"menubutton",menu:i})})}(),jQuery(window.document).ready(function(){"use strict";if(jQuery.fn.switchButton){var a=function(){jQuery(".appointments-settings .switch-button").each(function(){var a=jQuery(this).data("slave");if(a){var b=jQuery(".appointments-settings ."+a);jQuery(".switch-button-background",jQuery(this).closest("td")).hasClass("checked")?b.show():b.hide()}})};jQuery(".appointments-settings .switch-button").each(function(){var b={checked:jQuery(this).checked,on_label:jQuery(this).data("on")||switch_button.labels.label_on,off_label:jQuery(this).data("off")||switch_button.labels.label_off,on_callback:a,off_callback:a};jQuery(this).switchButton(b)})}});