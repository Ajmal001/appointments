/*!  - v2.4.3-beta.1
 * https://premium.wpmudev.org/project/appointments-plus/
 * Copyright (c) 2019; * Licensed GPLv2+ */
"use strict";window.Appointments=window.Appointments||{},Appointments.shortcodes=Appointments.shortcodes||{},jQuery(document).ready(function(a){Appointments.shortcodes.confirmation={init:function(){this.strings=AppShortcodeConfirmation,this.waitImg="<img class='wait_img' src='"+this.strings.waitingGif+"' />",this.$finalValue=a(".appointments-confirmation-final-value"),this.$confirmationButton=a(".appointments-confirmation-button"),this.$gcalEntry=a(".appointments-gcal-field-entry"),this.selectedValue="",this.bind()},bind:function(){var b=this,c=a("body");c.on("click",".app_timetable_cell.free, .app_week_timetable_cell.free",function(){b.preConfirmation.apply(b,[a(this)])}),c.on("click",".appointments-confirmation-cancel-button",function(){"function"==typeof app_cancel_location?window.location.href=app_cancel_location():window.location.reload()}),c.on("click",".appointments-confirmation-button",function(){b.confirmation.apply(b,[a(this)])})},preConfirmation:function(b){this.selectedValue="",b.css("text-align","center").append(this.waitImg);var c=b.find(".appointments_take_appointment").val();this.selectedValue=c;var d={action:"pre_confirmation",value:c,nonce:AppShortcodeConfirmation.nonce},e=this;a.post(AppShortcodeConfirmation.ajaxurl,d,function(b){if(a(".wait_img").remove(),b&&b.error)swal(AppShortcodeConfirmation.errorTitle,b.error,"error");else{a(".appointments-confirmation-wrapper").show(),a(".appointments-confirmation-service").html(b.service),b.service_location&&a(".appointments-confirmation-service_location").html(b.service_location).show(),b.worker&&a(".appointments-confirmation-worker").html(b.worker).show(),b.worker_location&&a(".appointments-confirmation-worker_location").html(b.worker_location).show(),a(".appointments-confirmation-start").html(b.start),a(".appointments-confirmation-end").html(b.end);var c=a(".appointments-confirmation-price");c.html(b.price),"0"!=b.price&&c.show(),e.strings.askName&&a(".appointments-name-field").show(),e.strings.askEmail&&a(".appointments-email-field").show(),e.strings.askPhone&&a(".appointments-phone-field").show(),e.strings.askAddress&&a(".appointments-address-field").show(),e.strings.askCity&&a(".appointments-city-field").show(),e.strings.askNote&&a(".appointments-note-field").show(),e.strings.askGCal&&a(".appointments-gcal-field").show(),a(".appointments-confirmation-button").focus();var d=a(".appointments-confirmation-wrapper").offset();d&&"top"in d&&d.top&&a(window).scrollTop(d.top)}},"json")},confirmation:function(){a(".appointments-confirmation-cancel-button").after(this.waitImg);var b=this.selectedValue,c=a(".appointments-name-field-entry").val(),d=a(".appointments-email-field-entry").val(),e=a(".appointments-phone-field-entry").val(),f=a(".appointments-address-field-entry").val(),g=a(".appointments-city-field-entry").val(),h=a(".appointments-note-field-entry").val(),i="",j=AppShortcodeConfirmation.warningText,k=AppShortcodeConfirmation.confirmationText,l=a(".appointments-gdpr-confirmation input[type=checkbox]"),m=this;this.$gcalEntry.is(":checked")&&(i=1);var n={action:"post_confirmation",value:b,app_name:c,app_email:d,app_phone:e,app_address:f,app_city:g,app_note:h,app_gcal:i,app_gdpr:l.is(":checked"),nonce:AppShortcodeConfirmation.nonce};return AppShortcodeConfirmation.askName&&""==a(".appointments-name-field-entry").val()?(swal(AppShortcodeConfirmation.errorTitle,j,"error"),a(".appointments-name-field-entry").focus(),a(".wait_img").remove(),!1):AppShortcodeConfirmation.askEmail&&""==a(".appointments-email-field-entry").val()?(swal(AppShortcodeConfirmation.errorTitle,j,"error"),a(".appointments-email-field-entry").focus(),a(".wait_img").remove(),!1):AppShortcodeConfirmation.askPhone&&""==a(".appointments-phone-field-entry").val()?(swal(AppShortcodeConfirmation.errorTitle,j,"error"),a(".appointments-phone-field-entry").focus(),a(".wait_img").remove(),!1):AppShortcodeConfirmation.askAddress&&""==a(".appointments-address-field-entry").val()?(swal(AppShortcodeConfirmation.errorTitle,j,"error"),a(".appointments-address-field-entry").focus(),a(".wait_img").remove(),!1):AppShortcodeConfirmation.askCity&&""==a(".appointments-city-field-entry").val()?(swal(AppShortcodeConfirmation.errorTitle,j,"error"),a(".appointments-city-field-entry").focus(),a(".wait_img").remove(),!1):AppShortcodeConfirmation.askGDPR&&!l.is(":checked")?(swal(AppShortcodeConfirmation.errorTitle,AppShortcodeConfirmation.GDPRmissingText,"error"),l.focus(),a(".wait_img").remove(),!1):void a.post(AppShortcodeConfirmation.ajaxurl,n,function(b){if(a(".wait_img").hide(),b&&b.error)swal({title:AppShortcodeConfirmation.errorTitle,text:b.error,type:"error"},function(){a(document).trigger("app-confirmation-response_received",[b])});else if(!b||"1"!=b.refresh&&0!=b.price)if(b){a(".appointments-paypal").find(".app_amount").val(b.price),a(".appointments-paypal").find(".app_custom").val(b.app_id);var c=a(".appointments-paypal").find(".app_submit_btn").val();if(c){var d=c.replace("PRICE",b.price).replace("SERVICE",b.service_name);a(".appointments-paypal").find(".app_submit_btn").val(d);var e=a(".appointments-paypal").find(".app_item_name").val(),f=e.replace("SERVICE",b.service_name);a(".appointments-paypal").find(".app_item_name").val(f),a(".appointments-paypal .app_submit_btn").focus()}""!=b.gcal_url&&window.open(b.gcal_url,"_blank"),1==b.mp?(a(".mp_buy_form").find("[name='variation']").remove().end().append("<input type='hidden' name='variation' />"),a(".mp_buy_form input[name='variation']").val(b.variation),a(".mp_buy_form").show()):a(".appointments-paypal").show(),a(document).trigger("app-confirmation-response_received",[b])}else swal({title:AppShortcodeConfirmation.errorTitle,text:m.strings.connectionErrorText,type:"error"},function(){a(document).trigger("app-confirmation-response_received",[b])});else swal({title:k,type:"success"},function(){""!=b.gcal_url?b.gcal_same_window?window.open(b.gcal_url,"_self"):(window.open(b.gcal_url,"_blank"),"function"==typeof app_location?window.location.href=app_location():window.location.reload()):"function"==typeof app_location?window.location.href=app_location():window.location.reload(),a(document).trigger("app-confirmation-response_received",[b])})},"json")}},Appointments.shortcodes.confirmation.init()});